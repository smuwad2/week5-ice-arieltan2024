<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
    crossorigin="anonymous"
  >
  <!-- Axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body onload="getCategories()">
  <div class="container-fluid">
    <h1 class="text-center">Supermarket</h1>

    <div class="row align-items-center my-3">
      <div class="col-md-3">
        <span class="lead">Category</span>
      </div>
      <div class="col-md-9">
        <select id="selectCategory" class="form-select" onchange="getItems()">
          <option value="0">To select</option>
          <option value="all">All</option>
        </select>
      </div>
    </div>

    <div id="itemsList" class="row my-3 py-3">
      <p class="text-center">No items</p>
    </div>
  </div>

  <script>
    function getCategories() {
      axios.get("/categories")
        .then(response => {
          showCategories(response.data);
        })
        .catch(error => {
          console.error("Error fetching categories:", error);
        });
    }

    function showCategories(categories) {
      const selectElem = document.getElementById("selectCategory");

      categories.forEach(c => {
        const optionElem = document.createElement("option");
        optionElem.value = c;           // set the option value
        optionElem.innerText = c;
        selectElem.appendChild(optionElem);
      });
    }

    function getItems() {
      const selectedCategory = document.getElementById("selectCategory").value;

      // If "To select" is still chosen, clear or preserve the placeholder
      if (selectedCategory === "0") {
        const itemsListDiv = document.getElementById("itemsList");
        itemsListDiv.innerHTML = '<p class="text-center">No items</p>';
        return;
      }

      let url = "/items";
      if (selectedCategory !== "all") {
        url += `?category=${encodeURIComponent(selectedCategory)}`;
      }

      axios.get(url)
        .then(response => {
          showItems(response.data);
        })
        .catch(error => {
          console.error("Error fetching items:", error);
          const itemsListDiv = document.getElementById("itemsList");
          itemsListDiv.innerHTML = '<p class="text-center text-danger">Error loading items</p>';
        });
    }

    function showItems(items) {
      const itemsListDiv = document.getElementById("itemsList");
      itemsListDiv.innerHTML = "";  // clear previous content

      if (!Array.isArray(items) || items.length === 0) {
        itemsListDiv.innerHTML = '<p class="text-center">No items</p>';
        return;
      }

      items.forEach(item => {
        const colDiv = document.createElement("div");
        colDiv.className = "col-lg-4 col-md-6 col-sm-12 mb-3";

        const cardDiv = document.createElement("div");
        cardDiv.className = "card h-100";

        const cardBody = document.createElement("div");
        cardBody.className = "card-body";

        const title = document.createElement("h5");
        title.className = "card-title text-center";
        title.innerText = item.name;

        const price = document.createElement("p");
        price.className = "card-text text-center";
        price.innerText = `Price: $${item.price}`;

        cardBody.appendChild(title);
        cardBody.appendChild(price);
        cardDiv.appendChild(cardBody);
        colDiv.appendChild(cardDiv);
        itemsListDiv.appendChild(colDiv);
      });
    }
  </script>

  <!-- Bootstrap JS Bundle -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
    crossorigin="anonymous"
  ></script>
</body>
</html>